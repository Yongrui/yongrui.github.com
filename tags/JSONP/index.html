<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>tag: JSONP</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Codemyown是一个个人博客，主要记录个人在web前端上的技术和难题和笔记...">
        <meta name="author" content="Codemyown">
        <meta name="keywords" content="Codemyown,html,CSS,javascript,web,前端,个人博客">
        <meta name="robots" content="index,follow">
        <meta name="application-name" content="codemyown.info">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>
          <div class="site">
            <div class="header">
              <div class="inner-header">
                <h1><a href="/">Codemyown</a></h1>
                <ul class="nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/archive.html">Archive</a></li>
                  <li><a href="#">About</a></li>
                  <li><a href="#">简历</a></li>
                </ul><!-- end nav -->
              </div>
            </div><!-- end header -->
            <div class="contain">
              <div class="sidebar">
                <div class="category">
                  <h3>Category</h3>
                  <ul>
                    
                    
   
   	<li class="cate"><a href="/categories/web相关" title="view all about 'web相关' category">
   		web相关 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/优化" title="view all about '优化' category">
   		优化 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/html5" title="view all about 'html5' category">
   		html5 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


                  </ul>
                </div>
                <div class="archive">
                  <h3>Archive</h3>
                  <ul>
                    
                    
  
  
  
  
 
  
    <li><a href="/archive.html#2013-June-ref" title="2013-June's posts">2013 June <span>(
  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

6


)</span></a></li>
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
  


                  </ul>
                </div>
                <div class="tag">
                  <h3>Tag</h3>
                  <ul>
                    
                    
  
    <li><a href="/tags/fullscreen-api" title="view all about 'fullscreen-api' tag">fullscreen-api <span>(1)</span></a></li>
  
    <li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
    <li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
    <li><a href="/tags/XMLHttpRequest" title="view all about 'XMLHttpRequest' tag">XMLHttpRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/flash" title="view all about 'flash' tag">flash <span>(1)</span></a></li>
  
    <li><a href="/tags/unity" title="view all about 'unity' tag">unity <span>(1)</span></a></li>
  
    <li><a href="/tags/XHR" title="view all about 'XHR' tag">XHR <span>(1)</span></a></li>
  
    <li><a href="/tags/前端优化" title="view all about '前端优化' tag">前端优化 <span>(1)</span></a></li>
  
    <li><a href="/tags/reflow" title="view all about 'reflow' tag">reflow <span>(1)</span></a></li>
  
    <li><a href="/tags/html5" title="view all about 'html5' tag">html5 <span>(2)</span></a></li>
  
    <li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
    <li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
    <li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
    <li><a href="/tags/repaint" title="view all about 'repaint' tag">repaint <span>(1)</span></a></li>
  
    <li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  
    <li><a href="/tags/android" title="view all about 'android' tag">android <span>(1)</span></a></li>
  
    <li><a href="/tags/XDR" title="view all about 'XDR' tag">XDR <span>(1)</span></a></li>
  
    <li><a href="/tags/cocos2d-x" title="view all about 'cocos2d-x' tag">cocos2d-x <span>(1)</span></a></li>
  
    <li><a href="/tags/中国开发者大会广州站" title="view all about '中国开发者大会广州站' tag">中国开发者大会广州站 <span>(1)</span></a></li>
  
    <li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  
    <li><a href="/tags/XDomainRequest" title="view all about 'XDomainRequest' tag">XDomainRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/CORS" title="view all about 'CORS' tag">CORS <span>(1)</span></a></li>
  
    <li><a href="/tags/ios" title="view all about 'ios' tag">ios <span>(1)</span></a></li>
  



                  </ul>
                </div>
              </div><!-- end sidebar -->
              <div class="main">
                <h2 class="result-header">All the articles by "JSONP" tag:</h2>

	<div class="post">
    	<h2><a href="/blog/2013/06/10/cors_2">跨域技术（二）</a></h2>
    	<ul class="meta">
    		<li class="date">
        		10 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
  	<li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>除了使用CORS实现跨域通信之外，我们还可以利用DOM中能够执行跨域请求的功能，在不依赖XHR对象的情况下发送某种请求，这些技术叫做图像Ping和JSONP。</p>

<h3 id='ping'>图像Ping</h3>

<p>我们知道，一个网页可以从任何网页中加载图像，不用担心跨不跨域，但是我却从来都不知道这居然也是一种跨域请求技术。图像Ping是与服务器进行简单、单向的跨域通信的一种方式。</p>

<p>在一个网页中，我们可以动态地创建图像，通过在src中以查询字符串的形式发送请求数据，使用它们的onload和onerror事件处理程序来确定是否接收到了响应，它的响应通常是像素图或204响应，但是浏览器得不到任何具体的数据，只能通过侦听load和error事件得知响应收到的时间。看下面的例子：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>img</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Image</span><span class='p'>();</span>
<span class='nx'>img</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='nx'>img</span><span class='p'>.</span><span class='nx'>onerror</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;Done!&quot;</span><span class='p'>);</span>
<span class='p'>};</span>
<span class='nx'>img</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='s2'>&quot;http://www.example.com/test?name=Nicholas&quot;</span><span class='p'>;</span>
</code></pre></div>
<p>这里创建了一个Image的实例，在请求中发送了一个name的参数，只要onload和onerror事件收到无论时什么响应，只要请求完成，我们就会知道。</p>

<p>图像Ping最常用于跟踪用户点击页面或动态广告曝光次数。它有两个主要的缺点：</p>
<ul>
<li>只能发送GET请求。</li>
<li>无法访问服务器的响应文本。</li>
</ul>
<p>所以，图像Ping只能用于浏览器与服务器间的简单通信。</p>

<h3 id='jsonp'>JSONP</h3>

<p>JSONP由两部分组成：</p>
<ul>
<li>回调函数：当响应来到时在页面中调用的函数。</li>
<li>数据：传入回调函数中的JSON数据。</li>
</ul>
<p>JSONP是通过动态<code>&lt;script&gt;</code>元素，然后为src属性指定一个跨域URL来实现的。看下面的例子：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>handleResponse</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;You are at IP address &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>ip</span> <span class='o'>+</span> <span class='s2'>&quot;, which is in &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>city</span> <span class='o'>+</span> <span class='s2'>&quot;, &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>region_name</span><span class='p'>);</span>
<span class='p'>}</span>

<span class='kd'>var</span> <span class='nx'>script</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s2'>&quot;script&quot;</span><span class='p'>);</span>
<span class='nx'>script</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='s2'>&quot;http://freegeoip.net/json/?callback=handleResponse&quot;</span><span class='p'>;</span>
<span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>insertBefore</span><span class='p'>(</span><span class='nx'>script</span><span class='p'>,</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>firstChild</span><span class='p'>);</span>
</code></pre></div>
<p>这是一个通过查询地理定位服务来显示你的IP地址和位置信息的例子。</p>

<p>JSONP与图像Ping相比，它的优点有：</p>
<ul>
<li>能够直接访问响应文本。</li>
<li>支持在浏览器与服务器之间双向通信。</li>
</ul>
<p>不过，JSONP也有亮点不足：</p>
<ul>
<li>JSONP时从其他域中加载代码执行，不能确定在响应中是否有恶意代码。</li>
<li>很难确定JSONP请求是否失败。</li>
</ul>
<p><strong><em>以上知识参考自<a href='http://www.wrox.com/WileyCDA/WroxTitle/Professional-JavaScript-for-Web-Developers-3rd-Edition.productCd-1118222199.html'>《JavaScript高级程序设计（第3版）》</a></em></strong></p></div>
    </div>

              </div><!-- end main -->
            </div><!-- end contain -->
            <div class="footer">
              <div class="inner-footer">
                <p>All contents of this site, unless otherwise noted, are &copy;2013-Sun Jun 23 12:27:57 +0800 2013 <strong>Yongrui</strong>.  All Rights Reserved.</p>
                <p>Proudly powered by <a href="http://jekyllrb.com/">Jekyll</a>.</p>
              </div>
            </div><!-- end footer -->
          </div><!-- end site -->
    </body>
</html>
