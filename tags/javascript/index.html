<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>tag: javascript</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Codemyown是一个个人博客，主要记录个人在web前端上的技术和难题和笔记...">
        <meta name="author" content="Codemyown">
        <meta name="keywords" content="Codemyown,html,CSS,javascript,web,前端,个人博客">
        <meta name="robots" content="index,follow">
        <meta name="application-name" content="codemyown.info">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>
          <div class="site">
            <div class="header">
              <div class="inner-header">
                <h1><a href="/">Codemyown</a></h1>
                <ul class="nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/archive.html">Archive</a></li>
                  <li><a href="#">About</a></li>
                  <li><a href="#">简历</a></li>
                </ul><!-- end nav -->
              </div>
            </div><!-- end header -->
            <div class="contain">
              <div class="sidebar">
                <div class="category">
                  <h3>Category</h3>
                  <ul>
                    
                    
   
   	<li class="cate"><a href="/categories/web相关" title="view all about 'web相关' category">
   		web相关 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/优化" title="view all about '优化' category">
   		优化 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/html5" title="view all about 'html5' category">
   		html5 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


                  </ul>
                </div>
                <div class="archive">
                  <h3>Archive</h3>
                  <ul>
                    
                    
  
  
  
  
 
  
    <li><a href="/archive.html#2013-June-ref" title="2013-June's posts">2013 June <span>(
  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

6


)</span></a></li>
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
  


                  </ul>
                </div>
                <div class="tag">
                  <h3>Tag</h3>
                  <ul>
                    
                    
  
    <li><a href="/tags/fullscreen-api" title="view all about 'fullscreen-api' tag">fullscreen-api <span>(1)</span></a></li>
  
    <li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
    <li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
    <li><a href="/tags/XMLHttpRequest" title="view all about 'XMLHttpRequest' tag">XMLHttpRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/flash" title="view all about 'flash' tag">flash <span>(1)</span></a></li>
  
    <li><a href="/tags/unity" title="view all about 'unity' tag">unity <span>(1)</span></a></li>
  
    <li><a href="/tags/XHR" title="view all about 'XHR' tag">XHR <span>(1)</span></a></li>
  
    <li><a href="/tags/前端优化" title="view all about '前端优化' tag">前端优化 <span>(1)</span></a></li>
  
    <li><a href="/tags/reflow" title="view all about 'reflow' tag">reflow <span>(1)</span></a></li>
  
    <li><a href="/tags/html5" title="view all about 'html5' tag">html5 <span>(2)</span></a></li>
  
    <li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
    <li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
    <li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
    <li><a href="/tags/repaint" title="view all about 'repaint' tag">repaint <span>(1)</span></a></li>
  
    <li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  
    <li><a href="/tags/android" title="view all about 'android' tag">android <span>(1)</span></a></li>
  
    <li><a href="/tags/XDR" title="view all about 'XDR' tag">XDR <span>(1)</span></a></li>
  
    <li><a href="/tags/cocos2d-x" title="view all about 'cocos2d-x' tag">cocos2d-x <span>(1)</span></a></li>
  
    <li><a href="/tags/中国开发者大会广州站" title="view all about '中国开发者大会广州站' tag">中国开发者大会广州站 <span>(1)</span></a></li>
  
    <li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  
    <li><a href="/tags/XDomainRequest" title="view all about 'XDomainRequest' tag">XDomainRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/CORS" title="view all about 'CORS' tag">CORS <span>(1)</span></a></li>
  
    <li><a href="/tags/ios" title="view all about 'ios' tag">ios <span>(1)</span></a></li>
  



                  </ul>
                </div>
              </div><!-- end sidebar -->
              <div class="main">
                <h2 class="result-header">All the articles by "javascript" tag:</h2>

	<div class="post">
    	<h2><a href="/blog/2013/06/10/cors_2">跨域技术（二）</a></h2>
    	<ul class="meta">
    		<li class="date">
        		10 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
  	<li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>除了使用CORS实现跨域通信之外，我们还可以利用DOM中能够执行跨域请求的功能，在不依赖XHR对象的情况下发送某种请求，这些技术叫做图像Ping和JSONP。</p>

<h3 id='ping'>图像Ping</h3>

<p>我们知道，一个网页可以从任何网页中加载图像，不用担心跨不跨域，但是我却从来都不知道这居然也是一种跨域请求技术。图像Ping是与服务器进行简单、单向的跨域通信的一种方式。</p>

<p>在一个网页中，我们可以动态地创建图像，通过在src中以查询字符串的形式发送请求数据，使用它们的onload和onerror事件处理程序来确定是否接收到了响应，它的响应通常是像素图或204响应，但是浏览器得不到任何具体的数据，只能通过侦听load和error事件得知响应收到的时间。看下面的例子：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>img</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Image</span><span class='p'>();</span>
<span class='nx'>img</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='nx'>img</span><span class='p'>.</span><span class='nx'>onerror</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;Done!&quot;</span><span class='p'>);</span>
<span class='p'>};</span>
<span class='nx'>img</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='s2'>&quot;http://www.example.com/test?name=Nicholas&quot;</span><span class='p'>;</span>
</code></pre></div>
<p>这里创建了一个Image的实例，在请求中发送了一个name的参数，只要onload和onerror事件收到无论时什么响应，只要请求完成，我们就会知道。</p>

<p>图像Ping最常用于跟踪用户点击页面或动态广告曝光次数。它有两个主要的缺点：</p>
<ul>
<li>只能发送GET请求。</li>
<li>无法访问服务器的响应文本。</li>
</ul>
<p>所以，图像Ping只能用于浏览器与服务器间的简单通信。</p>

<h3 id='jsonp'>JSONP</h3>

<p>JSONP由两部分组成：</p>
<ul>
<li>回调函数：当响应来到时在页面中调用的函数。</li>
<li>数据：传入回调函数中的JSON数据。</li>
</ul>
<p>JSONP是通过动态<code>&lt;script&gt;</code>元素，然后为src属性指定一个跨域URL来实现的。看下面的例子：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>handleResponse</span><span class='p'>(</span><span class='nx'>response</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;You are at IP address &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>ip</span> <span class='o'>+</span> <span class='s2'>&quot;, which is in &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>city</span> <span class='o'>+</span> <span class='s2'>&quot;, &quot;</span> <span class='o'>+</span> <span class='nx'>response</span><span class='p'>.</span><span class='nx'>region_name</span><span class='p'>);</span>
<span class='p'>}</span>

<span class='kd'>var</span> <span class='nx'>script</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>createElement</span><span class='p'>(</span><span class='s2'>&quot;script&quot;</span><span class='p'>);</span>
<span class='nx'>script</span><span class='p'>.</span><span class='nx'>src</span> <span class='o'>=</span> <span class='s2'>&quot;http://freegeoip.net/json/?callback=handleResponse&quot;</span><span class='p'>;</span>
<span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>insertBefore</span><span class='p'>(</span><span class='nx'>script</span><span class='p'>,</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>firstChild</span><span class='p'>);</span>
</code></pre></div>
<p>这是一个通过查询地理定位服务来显示你的IP地址和位置信息的例子。</p>

<p>JSONP与图像Ping相比，它的优点有：</p>
<ul>
<li>能够直接访问响应文本。</li>
<li>支持在浏览器与服务器之间双向通信。</li>
</ul>
<p>不过，JSONP也有亮点不足：</p>
<ul>
<li>JSONP时从其他域中加载代码执行，不能确定在响应中是否有恶意代码。</li>
<li>很难确定JSONP请求是否失败。</li>
</ul>
<p><strong><em>以上知识参考自<a href='http://www.wrox.com/WileyCDA/WroxTitle/Professional-JavaScript-for-Web-Developers-3rd-Edition.productCd-1118222199.html'>《JavaScript高级程序设计（第3版）》</a></em></strong></p></div>
    </div>

	<div class="post">
    	<h2><a href="/blog/2013/06/09/cors">跨域技术（一）</a></h2>
    	<ul class="meta">
    		<li class="date">
        		09 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/CORS" title="view all about 'CORS' tag">CORS <span>(1)</span></a></li>
  
  	<li><a href="/tags/XDomainRequest" title="view all about 'XDomainRequest' tag">XDomainRequest <span>(1)</span></a></li>
  
  	<li><a href="/tags/XDR" title="view all about 'XDR' tag">XDR <span>(1)</span></a></li>
  
  	<li><a href="/tags/XMLHttpRequest" title="view all about 'XMLHttpRequest' tag">XMLHttpRequest <span>(1)</span></a></li>
  
  	<li><a href="/tags/XHR" title="view all about 'XHR' tag">XHR <span>(1)</span></a></li>
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>今天对javascript高级程序设计第三版这本书的内容复习了一下，刚好看到了跨源资源共享这章，觉得有必要写一下。</p>

<p>默认情况下，XHR(XMLHttpReques)对象只能访问与包含它的页面位于同一个域中的资源。如果想要请求跨域资源就要用到跨域技术。</p>

<p>CORS(Cross-Origin Resource Sharing，跨源资源共享)定义了在必须访问跨源资源时，浏览器和服务器应该如何沟通，它背后的思想是使用自定义的HTTP头部让浏览器与服务器沟通。比如，发送一个GET或POST请求时，需要给它附加一个额外的Origin头部，其中包含请求页面的源信息（协议、域名和端口）。如果服务器认为这个请求可以接受，就在Access-Control-Allow-Origin头部中发回相同的源信息。</p>

<h3 id='iecors'>IE对CORS的实现</h3>

<p>微软在IE8中引入了XDR(XDomainRequest)类型来实现安全可靠的跨域通信。XDR和XHR的一些不同之处在于：</p>

<ul>
<li>cookie不会随请求发送，也不会随响应返回。</li>

<li>只能设置请求头部信息中的Content-Type字段。 - 不能访问响应头部信息。</li>

<li>只支持GET和POST请求。</li>
</ul>

<p>所有XDR请求都是异步执行的，不能用它来创建同步请求。请求返回之后，就会触发load事件，响应数据保存在responseText属性中，而且只能访问响应的原始文本，没有办法访问响应的状态码；如果失败就会触发error事件。如下例子所示：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>xdr</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>XDomainRequest</span><span class='p'>();</span> <span class='c1'>// 获得XDR对象</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span> <span class='c1'>// 响应之后的处理</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>responseText</span><span class='p'>);</span>
<span class='p'>};</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>onerror</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span> <span class='c1'>// 失败之后的处理</span>
    <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;An error occurred.&quot;</span><span class='p'>);</span>
<span class='p'>};</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='s2'>&quot;get&quot;</span><span class='p'>,</span> <span class='s2'>&quot;http://www.example.com&quot;</span><span class='p'>);</span> <span class='c1'>// 启动请求</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>send</span><span class='p'>(</span><span class='kc'>null</span><span class='p'>);</span> <span class='c1'>// 发送请求</span>
</code></pre></div>
<p>为了支持POST请求，XDR对象提供了contentType属性，用来发送数据的格式，如下所示：</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>...</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='s2'>&quot;post&quot;</span><span class='p'>,</span> <span class='s2'>&quot;http://www.example.com&quot;</span><span class='p'>);</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>contentType</span> <span class='o'>=</span> <span class='s2'>&quot;application/x-www-form-urlencoded&quot;</span><span class='p'>;</span>
<span class='nx'>xdr</span><span class='p'>.</span><span class='nx'>send</span><span class='p'>(</span><span class='s2'>&quot;name1=value1&amp;name2=value2&quot;</span><span class='p'>);</span>
</code></pre></div>
<p>这个属性时通过XDR对象影响头部信息的唯一方式。</p>

<h3 id='cors'>其他浏览器对CORS的实现</h3>

<p>Firefox3.5+、Safari4+、Chrome、iOS版Safari和Android平台中的WebKit都通过XMLHttpRequest对象实现了对CORS的原生支持。要请求位于另一个域中的资源只需要使用标准的XHR对象并在open()方法中传入绝对URL即可.</p>

<p>与XDR对象不同，通过跨域XHR对象可以访问status和statusText属性，而且还支持同步请求。例如：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>xhr</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>XMLHttpRequest</span><span class='p'>();</span>
<span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>onreadystatechange</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>readyState</span> <span class='o'>==</span> <span class='mi'>4</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>((</span><span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>status</span> <span class='o'>&gt;=</span> <span class='mi'>200</span> <span class='o'>&amp;&amp;</span> <span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>status</span> <span class='o'>&lt;</span> <span class='mi'>300</span><span class='p'>)</span> <span class='o'>||</span> <span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>status</span> <span class='o'>==</span> <span class='mi'>304</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='nx'>alert</span><span class='p'>(</span><span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>responseText</span><span class='p'>);</span>
        <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
            <span class='nx'>alert</span><span class='p'>(</span><span class='s2'>&quot;Request was unsuccessful: &quot;</span> <span class='o'>+</span> <span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>status</span><span class='p'>);</span>
        <span class='p'>}</span>
    <span class='p'>}</span>
<span class='p'>};</span>
<span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='s2'>&quot;get&quot;</span><span class='p'>,</span> <span class='s2'>&quot;http://www.example.com&quot;</span><span class='p'>,</span> <span class='kc'>true</span><span class='p'>);</span>
<span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>send</span><span class='p'>(</span><span class='kc'>null</span><span class='p'>);</span>
</code></pre></div>
<p>跨域XHR对象也有一些限制：</p>

<ul>
<li>不能使用setRequestHeader()设置自定义头部。</li>

<li>不能发送和接收cookie。</li>

<li>调用getAllResponseHeaders()方法总会返回空字符串。</li>
</ul>
<p />
<h3 id='cors'>跨浏览器的CORS</h3>

<p>检测XHR是否支持CORS可以检查是否存在withCredentials属性，再结合检测XDomainRequest对象是否存在，就可以兼顾所有浏览器了。代码如下：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>createCORSRequest</span><span class='p'>(</span><span class='nx'>method</span><span class='p'>,</span> <span class='nx'>url</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>xhr</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>XMLHttpRequest</span><span class='p'>();</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='s2'>&quot;withCredentials&quot;</span> <span class='k'>in</span> <span class='nx'>xhr</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='nx'>method</span><span class='p'>,</span> <span class='nx'>url</span><span class='p'>,</span> <span class='kc'>true</span><span class='p'>);</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span><span class='nx'>type</span> <span class='nx'>XDomainRequest</span> <span class='o'>!=</span> <span class='s2'>&quot;undefined&quot;</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='nx'>xhr</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>XDomainRequest</span><span class='p'>();</span>
        <span class='nx'>xhr</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='nx'>method</span><span class='p'>,</span> <span class='nx'>url</span><span class='p'>);</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
        <span class='nx'>xhr</span> <span class='o'>=</span> <span class='kc'>null</span><span class='p'>;</span>
    <span class='p'>}</span>
    <span class='k'>return</span> <span class='nx'>xhr</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='kd'>var</span> <span class='nx'>request</span> <span class='o'>=</span> <span class='nx'>createCORSRequest</span><span class='p'>(</span><span class='s2'>&quot;get&quot;</span><span class='p'>,</span> <span class='s2'>&quot;http://www.example.com&quot;</span><span class='p'>);</span>
<span class='k'>if</span> <span class='p'>(</span><span class='nx'>request</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>request</span><span class='p'>.</span><span class='nx'>onload</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
        <span class='c1'>// 对request.responseText进行处理</span>
    <span class='p'>};</span>
    <span class='nx'>request</span><span class='p'>.</span><span class='nx'>send</span><span class='p'>();</span>
<span class='p'>}</span>
</code></pre></div>
<p>Firefox、Safari和Chrome中的XMLHttpRequest对象与IE中的XDomainRequest对象提供了共同的属性或方法，如下：</p>

<ul>
<li>abort()：用于停止正在进行的请求。</li>

<li>onerror：用于替代onreadystatechange检测错误。</li>

<li>onload：用于替代onreadystatechange检测成功。</li>

<li>responseText：用于取得响应内容。</li>

<li>send()：用于发送请求。</li>
</ul>

<p>以上成员都包含在createCORSRequest()函数返回的对象中，在所有浏览器中都能正常使用。</p></div>
    </div>

	<div class="post">
    	<h2><a href="/blog/2013/06/08/endless-scroll">无限翻页</a></h2>
    	<ul class="meta">
    		<li class="date">
        		08 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
  	<li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
  	<li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>无限翻页非常适合展现零散的、实时推送和按时间排列的信息，在浏览大量条目时无限翻页更有效，但无限翻页并不是一个万全之策,所以我们需要考虑充分才能使用。其实对于搜索结果、长列表和电子商务来说，分页导航也许才是最好的选择。</p>

<p>分页导航几乎只是基于技术原因提出的：</p>
<ul>
<li>老版本浏览器渲染慢</li>
<li>客户端和服务器之间任何一处都可能有带宽限制,这要求我们减少页面大小</li>
<li>服务器端的处理时间随着数据增多而增加.一次性渲染整个数据集不仅是浪费,而且对服务器来说也不可行,尤其是服务器想要处理足够多的并发请求时</li>
</ul>
<p>分页导航只不过是一种方法，一种不用JavaScript的方法。启用了JavaScript之后，如果用无限翻页比较合适的话，我们就可以不用任何分页链接，而用无限翻页来代替它们。</p>

<p>原理是首先判断文档底部离当前显示区域底部的距离不太远,然后在滚动条滚动到恰当的位置时载入更多内容，代码如下：</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// 判断是否已滚动到足够低</span>
<span class='kd'>function</span> <span class='nx'>lowEnougn</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>pageHeight</span> <span class='o'>=</span> <span class='nb'>Math</span><span class='p'>.</span><span class='nx'>max</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>scrollHeight</span><span class='p'>,</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>offsetHeight</span><span class='p'>);</span>
    <span class='kd'>var</span> <span class='nx'>viewportHeight</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>innerHeight</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>documentElement</span><span class='p'>.</span><span class='nx'>clientHeight</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>clientHeight</span> <span class='o'>||</span> <span class='mi'>0</span><span class='p'>;</span>
    <span class='kd'>var</span> <span class='nx'>scrollHeight</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>pageYOffset</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>documentElement</span><span class='p'>.</span><span class='nx'>scrollTop</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>scrollTop</span> <span class='o'>||</span> <span class='mi'>0</span><span class='p'>;</span>

    <span class='c1'>// 在离页面询问20像素时触发翻页</span>
    <span class='k'>return</span> <span class='nx'>pageHeight</span> <span class='o'>-</span> <span class='nx'>viewportHeight</span> <span class='o'>-</span> <span class='nx'>scrollHeight</span> <span class='o'>&lt;</span> <span class='mi'>20</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='c1'>// 监测滚动位置并载入更多内容</span>
<span class='kd'>function</span> <span class='nx'>checkScroll</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nx'>lowEnougn</span><span class='p'>())</span> <span class='p'>{</span>
        <span class='k'>return</span> <span class='nx'>pollScroll</span><span class='p'>();</span>
    <span class='p'>};</span>

    <span class='c1'>// Do something</span>
    <span class='c1'>// Load more contents with ajax or ...</span>
    <span class='nx'>$</span><span class='p'>.</span><span class='nx'>ajax</span><span class='p'>({</span>
        <span class='nx'>type</span><span class='o'>:</span> <span class='s2'>&quot;GET&quot;</span><span class='p'>,</span>
        <span class='nx'>url</span><span class='o'>:</span> <span class='s2'>&quot;example.php&quot;</span><span class='p'>,</span>
        <span class='nx'>success</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>msg</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='c1'>// 添加内容</span>
        <span class='p'>},</span>
        <span class='nx'>complete</span><span class='o'>:</span> <span class='nx'>pollScroll</span>
    <span class='p'>});</span>
<span class='p'>}</span>

<span class='kd'>function</span> <span class='nx'>pollScroll</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='nx'>setTimeout</span><span class='p'>(</span><span class='nx'>checkScroll</span><span class='p'>,</span> <span class='mi'>100</span><span class='p'>);</span>
<span class='p'>}</span>

<span class='nx'>pollScroll</span><span class='p'>();</span>
</code></pre></div>
<p>上面的代码其实没有什么特别奇特的地方，实质上是在判断文档底部离当前显示区域底部是否足够低，然后频繁地检查垂直滚动条的当前状态，每秒10次！然后用Ajax载入更多内容。唯一比较棘手的就是跨浏览器正确计算长度比较麻烦，这从lowEnough()方法的代码中可以很明显地看到。</p>

<p>如果需要考虑到可用性和容错，也可以提供分页导航：把下一页链接设置为默认隐藏，如果Ajax获取数据失败就显示这些链接，这样用户还可以回到用分页链接来操作的状态。</p></div>
    </div>

	<div class="post">
    	<h2><a href="/blog/2013/06/05/fullscreen-api">HTML5 Fullscreen Api</a></h2>
    	<ul class="meta">
    		<li class="date">
        		05 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/html5" title="view all about 'html5' category">
   		html5 <span>(1)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/html5" title="view all about 'html5' tag">html5 <span>(2)</span></a></li>
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/fullscreen-api" title="view all about 'fullscreen-api' tag">fullscreen-api <span>(1)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>HTML5给我们提供了全屏化的方法：Fullscreen API，其实就是一组简单的Javascript API。Fullscreen API给开发者提供了一种可编程化的方法将全屏种取消全屏的选择提供给用户，这在web应用和web游戏中是非常有用的。主要的API如下：</p>

<h3 id='id4'>启动全屏</h3>
<p /><div class='highlight'><pre><code class='javascript'><span class='c1'>// 某个元素的全屏化</span>
<span class='nx'>element</span><span class='p'>.</span><span class='nx'>requestFullScreen</span><span class='p'>();</span>
</code></pre></div>
<p>在不同的浏览器中使用需要添加前缀，例如写一个跨浏览器的requestFullScreen方法：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>launchFullScreen</span><span class='p'>(</span><span class='nx'>element</span><span class='p'>)</span> <span class='p'>{</span>
	<span class='k'>if</span> <span class='p'>(</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>requestFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// W3C标准</span>
            <span class='nx'>element</span><span class='p'>.</span><span class='nx'>requestFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span> <span class='nx'>eles</span> <span class='k'>if</span> <span class='p'>(</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>webkitRequestFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// Chrome/Safari</span>
        <span class='nx'>element</span><span class='p'>.</span><span class='nx'>webkitRequestFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span><span class='nx'>element</span><span class='p'>.</span><span class='nx'>mozRequestFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// Firefox</span>
        <span class='nx'>element</span><span class='p'>.</span><span class='nx'>mozRequestFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span>
<span class='p'>}</span>
    
<span class='c1'>// 调用launchFullScreen方法</span>
<span class='nx'>launchFullScreen</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>documentElement</span><span class='p'>);</span> <span class='c1'>// 整个页面全屏化</span>
<span class='nx'>launchFullScreen</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>getElementById</span><span class='p'>(</span><span class='s2'>&quot;myVideoElement&quot;</span><span class='p'>));</span> <span class='c1'>// 单个元素的全屏化</span>
</code></pre></div><p />
<h3 id='id5'>退出全屏</h3>
<p /><div class='highlight'><pre><code class='javascript'><span class='c1'>// 退出全屏化</span>
<span class='nb'>document</span><span class='p'>.</span><span class='nx'>cancelFullScreen</span><span class='p'>();</span>
</code></pre></div>
<p>和requestFullScreen一样，在不同的浏览器中使用需要添加前缀，例如写一个跨浏览器的cancelFullScreen方法：</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>cancelFullscreen</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>if</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>cancelFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// W3C标准</span>
        <span class='nb'>document</span><span class='p'>.</span><span class='nx'>cancelFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>webkitCancelFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// Chrome/Safari</span>
        <span class='nb'>document</span><span class='p'>.</span><span class='nx'>mozCancelFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>mozCancelFullScreen</span><span class='p'>)</span> <span class='p'>{</span> <span class='c1'>// Firefox</span>
        <span class='nb'>document</span><span class='p'>.</span><span class='nx'>webkitCancelFullScreen</span><span class='p'>();</span>
    <span class='p'>}</span>
<span class='p'>}</span>
    
<span class='c1'>// 调用cancelFullScreen方法</span>
<span class='nx'>cancelFullScreen</span><span class='p'>();</span>
</code></pre></div><p />
<h3 id='fullscreen'>Fullscreen属性</h3>
<p /><div class='highlight'><pre><code class='javascript'><span class='nb'>document</span><span class='p'>.</span><span class='nx'>fullScreenElement</span> <span class='c1'>// 返回全屏的元素，没有全屏则返回null</span>
<span class='nb'>document</span><span class='p'>.</span><span class='nx'>fullScreenEnabled</span> <span class='c1'>// 标记或判断当前全屏是否可用</span>
    
<span class='kd'>var</span> <span class='nx'>fullscreenElement</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>fullscreenElement</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>mozFullScreenElement</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>webkitFullscreenElement</span><span class='p'>;</span>
<span class='kd'>var</span> <span class='nx'>fullscreenEnabled</span> <span class='o'>=</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>fullscreenEnabled</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>mozFullScreenEnabled</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>webkitFullscreenEnabled</span><span class='p'>;</span>
</code></pre></div><p />
<h3 id='fullscreen'>Fullscreen事件</h3>

<p>浏览器支持全屏事件 <code>fullscreenchange</code>，让开发者可以为全屏做更多事情：</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// Chrome/Safari</span>
<span class='nx'>element</span><span class='p'>.</span><span class='nx'>onwebkitfullscreenchange</span>
    
<span class='c1'>// Firefox</span>
<span class='nx'>element</span><span class='p'>.</span><span class='nx'>onmozfullscreenchange</span>
    
<span class='c1'>// W3C</span>
<span class='nx'>element</span><span class='p'>.</span><span class='nx'>addEventListener</span><span class='p'>(</span><span class='s2'>&quot;fullscreenchange&quot;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>e</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='c1'>// To do something</span>
<span class='p'>},</span> <span class='kc'>false</span><span class='p'>);</span>
</code></pre></div><p />
<h3 id='fullscreen_css'>Fullscreen CSS</h3>

<p>浏览器也对Fullscreen CSS伪类提供了支持：</p>
<div class='highlight'><pre><code class='css'><span class='c'>/* html */</span>
<span class='nd'>:-webkit-full-screen</span> <span class='p'>{</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='nb'>pink</span><span class='p'>;</span>
<span class='p'>}</span>
<span class='nd'>:-moz-full-screen</span> <span class='p'>{</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='nb'>pink</span><span class='p'>;</span>
<span class='p'>}</span>
    
<span class='c'>/* elements */</span>
<span class='nd'>:-webkit-full-screen</span> <span class='nt'>video</span> <span class='p'>{</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>100</span><span class='o'>%</span><span class='p'>;</span>
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>100</span><span class='o'>%</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre></div></div>
    </div>

              </div><!-- end main -->
            </div><!-- end contain -->
            <div class="footer">
              <div class="inner-footer">
                <p>All contents of this site, unless otherwise noted, are &copy;2013-Sun Jun 23 12:27:57 +0800 2013 <strong>Yongrui</strong>.  All Rights Reserved.</p>
                <p>Proudly powered by <a href="http://jekyllrb.com/">Jekyll</a>.</p>
              </div>
            </div><!-- end footer -->
          </div><!-- end site -->
    </body>
</html>
