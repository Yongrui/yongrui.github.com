<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>tag: 无限翻页</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Codemyown是一个个人博客，主要记录个人在web前端上的技术和难题和笔记...">
        <meta name="author" content="Codemyown">
        <meta name="keywords" content="Codemyown,html,CSS,javascript,web,前端,个人博客">
        <meta name="robots" content="index,follow">
        <meta name="application-name" content="codemyown.info">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>
          <div class="site">
            <div class="header">
              <div class="inner-header">
                <h1><a href="/">Codemyown</a></h1>
                <ul class="nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/archive.html">Archive</a></li>
                  <li><a href="#">About</a></li>
                  <li><a href="#">简历</a></li>
                </ul><!-- end nav -->
              </div>
            </div><!-- end header -->
            <div class="contain">
              <div class="sidebar">
                <div class="category">
                  <h3>Category</h3>
                  <ul>
                    
                    
   
   	<li class="cate"><a href="/categories/web相关" title="view all about 'web相关' category">
   		web相关 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/优化" title="view all about '优化' category">
   		优化 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/html5" title="view all about 'html5' category">
   		html5 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


                  </ul>
                </div>
                <div class="archive">
                  <h3>Archive</h3>
                  <ul>
                    
                    
  
  
  
  
 
  
    <li><a href="/archive.html#2013-June-ref" title="2013-June's posts">2013 June <span>(
  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

6


)</span></a></li>
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
  


                  </ul>
                </div>
                <div class="tag">
                  <h3>Tag</h3>
                  <ul>
                    
                    
  
    <li><a href="/tags/fullscreen-api" title="view all about 'fullscreen-api' tag">fullscreen-api <span>(1)</span></a></li>
  
    <li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
    <li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
    <li><a href="/tags/XMLHttpRequest" title="view all about 'XMLHttpRequest' tag">XMLHttpRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/flash" title="view all about 'flash' tag">flash <span>(1)</span></a></li>
  
    <li><a href="/tags/unity" title="view all about 'unity' tag">unity <span>(1)</span></a></li>
  
    <li><a href="/tags/XHR" title="view all about 'XHR' tag">XHR <span>(1)</span></a></li>
  
    <li><a href="/tags/前端优化" title="view all about '前端优化' tag">前端优化 <span>(1)</span></a></li>
  
    <li><a href="/tags/reflow" title="view all about 'reflow' tag">reflow <span>(1)</span></a></li>
  
    <li><a href="/tags/html5" title="view all about 'html5' tag">html5 <span>(2)</span></a></li>
  
    <li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
    <li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
    <li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
    <li><a href="/tags/repaint" title="view all about 'repaint' tag">repaint <span>(1)</span></a></li>
  
    <li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  
    <li><a href="/tags/android" title="view all about 'android' tag">android <span>(1)</span></a></li>
  
    <li><a href="/tags/XDR" title="view all about 'XDR' tag">XDR <span>(1)</span></a></li>
  
    <li><a href="/tags/cocos2d-x" title="view all about 'cocos2d-x' tag">cocos2d-x <span>(1)</span></a></li>
  
    <li><a href="/tags/中国开发者大会广州站" title="view all about '中国开发者大会广州站' tag">中国开发者大会广州站 <span>(1)</span></a></li>
  
    <li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  
    <li><a href="/tags/XDomainRequest" title="view all about 'XDomainRequest' tag">XDomainRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/CORS" title="view all about 'CORS' tag">CORS <span>(1)</span></a></li>
  
    <li><a href="/tags/ios" title="view all about 'ios' tag">ios <span>(1)</span></a></li>
  



                  </ul>
                </div>
              </div><!-- end sidebar -->
              <div class="main">
                <h2 class="result-header">All the articles by "无限翻页" tag:</h2>

	<div class="post">
    	<h2><a href="/blog/2013/06/08/endless-scroll">无限翻页</a></h2>
    	<ul class="meta">
    		<li class="date">
        		08 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
  	<li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
  	<li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
  	<li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><p>无限翻页非常适合展现零散的、实时推送和按时间排列的信息，在浏览大量条目时无限翻页更有效，但无限翻页并不是一个万全之策,所以我们需要考虑充分才能使用。其实对于搜索结果、长列表和电子商务来说，分页导航也许才是最好的选择。</p>

<p>分页导航几乎只是基于技术原因提出的：</p>
<ul>
<li>老版本浏览器渲染慢</li>
<li>客户端和服务器之间任何一处都可能有带宽限制,这要求我们减少页面大小</li>
<li>服务器端的处理时间随着数据增多而增加.一次性渲染整个数据集不仅是浪费,而且对服务器来说也不可行,尤其是服务器想要处理足够多的并发请求时</li>
</ul>
<p>分页导航只不过是一种方法，一种不用JavaScript的方法。启用了JavaScript之后，如果用无限翻页比较合适的话，我们就可以不用任何分页链接，而用无限翻页来代替它们。</p>

<p>原理是首先判断文档底部离当前显示区域底部的距离不太远,然后在滚动条滚动到恰当的位置时载入更多内容，代码如下：</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// 判断是否已滚动到足够低</span>
<span class='kd'>function</span> <span class='nx'>lowEnougn</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>pageHeight</span> <span class='o'>=</span> <span class='nb'>Math</span><span class='p'>.</span><span class='nx'>max</span><span class='p'>(</span><span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>scrollHeight</span><span class='p'>,</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>offsetHeight</span><span class='p'>);</span>
    <span class='kd'>var</span> <span class='nx'>viewportHeight</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>innerHeight</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>documentElement</span><span class='p'>.</span><span class='nx'>clientHeight</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>clientHeight</span> <span class='o'>||</span> <span class='mi'>0</span><span class='p'>;</span>
    <span class='kd'>var</span> <span class='nx'>scrollHeight</span> <span class='o'>=</span> <span class='nb'>window</span><span class='p'>.</span><span class='nx'>pageYOffset</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>documentElement</span><span class='p'>.</span><span class='nx'>scrollTop</span> <span class='o'>||</span> <span class='nb'>document</span><span class='p'>.</span><span class='nx'>body</span><span class='p'>.</span><span class='nx'>scrollTop</span> <span class='o'>||</span> <span class='mi'>0</span><span class='p'>;</span>

    <span class='c1'>// 在离页面询问20像素时触发翻页</span>
    <span class='k'>return</span> <span class='nx'>pageHeight</span> <span class='o'>-</span> <span class='nx'>viewportHeight</span> <span class='o'>-</span> <span class='nx'>scrollHeight</span> <span class='o'>&lt;</span> <span class='mi'>20</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='c1'>// 监测滚动位置并载入更多内容</span>
<span class='kd'>function</span> <span class='nx'>checkScroll</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nx'>lowEnougn</span><span class='p'>())</span> <span class='p'>{</span>
        <span class='k'>return</span> <span class='nx'>pollScroll</span><span class='p'>();</span>
    <span class='p'>};</span>

    <span class='c1'>// Do something</span>
    <span class='c1'>// Load more contents with ajax or ...</span>
    <span class='nx'>$</span><span class='p'>.</span><span class='nx'>ajax</span><span class='p'>({</span>
        <span class='nx'>type</span><span class='o'>:</span> <span class='s2'>&quot;GET&quot;</span><span class='p'>,</span>
        <span class='nx'>url</span><span class='o'>:</span> <span class='s2'>&quot;example.php&quot;</span><span class='p'>,</span>
        <span class='nx'>success</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>msg</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='c1'>// 添加内容</span>
        <span class='p'>},</span>
        <span class='nx'>complete</span><span class='o'>:</span> <span class='nx'>pollScroll</span>
    <span class='p'>});</span>
<span class='p'>}</span>

<span class='kd'>function</span> <span class='nx'>pollScroll</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='nx'>setTimeout</span><span class='p'>(</span><span class='nx'>checkScroll</span><span class='p'>,</span> <span class='mi'>100</span><span class='p'>);</span>
<span class='p'>}</span>

<span class='nx'>pollScroll</span><span class='p'>();</span>
</code></pre></div>
<p>上面的代码其实没有什么特别奇特的地方，实质上是在判断文档底部离当前显示区域底部是否足够低，然后频繁地检查垂直滚动条的当前状态，每秒10次！然后用Ajax载入更多内容。唯一比较棘手的就是跨浏览器正确计算长度比较麻烦，这从lowEnough()方法的代码中可以很明显地看到。</p>

<p>如果需要考虑到可用性和容错，也可以提供分页导航：把下一页链接设置为默认隐藏，如果Ajax获取数据失败就显示这些链接，这样用户还可以回到用分页链接来操作的状态。</p></div>
    </div>

              </div><!-- end main -->
            </div><!-- end contain -->
            <div class="footer">
              <div class="inner-footer">
                <p>All contents of this site, unless otherwise noted, are &copy;2013-Sun Jun 23 12:27:57 +0800 2013 <strong>Yongrui</strong>.  All Rights Reserved.</p>
                <p>Proudly powered by <a href="http://jekyllrb.com/">Jekyll</a>.</p>
              </div>
            </div><!-- end footer -->
          </div><!-- end site -->
    </body>
</html>
