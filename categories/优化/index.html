<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Category: 优化</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Codemyown是一个个人博客，主要记录个人在web前端上的技术和难题和笔记...">
        <meta name="author" content="Codemyown">
        <meta name="keywords" content="Codemyown,html,CSS,javascript,web,前端,个人博客">
        <meta name="robots" content="index,follow">
        <meta name="application-name" content="codemyown.info">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>
          <div class="site">
            <div class="header">
              <div class="inner-header">
                <h1><a href="/">Codemyown</a></h1>
                <ul class="nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/archive.html">Archive</a></li>
                  <li><a href="#">About</a></li>
                  <li><a href="#">简历</a></li>
                </ul><!-- end nav -->
              </div>
            </div><!-- end header -->
            <div class="contain">
              <div class="sidebar">
                <div class="category">
                  <h3>Category</h3>
                  <ul>
                    
                    
   
   	<li class="cate"><a href="/categories/web相关" title="view all about 'web相关' category">
   		web相关 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/优化" title="view all about '优化' category">
   		优化 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/html5" title="view all about 'html5' category">
   		html5 <span>(1)</span>
   	</a></li>
   
   	<li class="cate"><a href="/categories/javascript" title="view all about 'javascript' category">
   		javascript <span>(3)</span>
   	</a></li>
  


                  </ul>
                </div>
                <div class="archive">
                  <h3>Archive</h3>
                  <ul>
                    
                    
  
  
  
  
 
  
    <li><a href="/archive.html#2013-June-ref" title="2013-June's posts">2013 June <span>(
  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

  
  

  
    
  

6


)</span></a></li>
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
    
      
    
  

  
  
  
  
 
  

  
  


                  </ul>
                </div>
                <div class="tag">
                  <h3>Tag</h3>
                  <ul>
                    
                    
  
    <li><a href="/tags/fullscreen-api" title="view all about 'fullscreen-api' tag">fullscreen-api <span>(1)</span></a></li>
  
    <li><a href="/tags/无限翻页" title="view all about '无限翻页' tag">无限翻页 <span>(1)</span></a></li>
  
    <li><a href="/tags/JSONP" title="view all about 'JSONP' tag">JSONP <span>(1)</span></a></li>
  
    <li><a href="/tags/XMLHttpRequest" title="view all about 'XMLHttpRequest' tag">XMLHttpRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/flash" title="view all about 'flash' tag">flash <span>(1)</span></a></li>
  
    <li><a href="/tags/unity" title="view all about 'unity' tag">unity <span>(1)</span></a></li>
  
    <li><a href="/tags/XHR" title="view all about 'XHR' tag">XHR <span>(1)</span></a></li>
  
    <li><a href="/tags/前端优化" title="view all about '前端优化' tag">前端优化 <span>(1)</span></a></li>
  
    <li><a href="/tags/reflow" title="view all about 'reflow' tag">reflow <span>(1)</span></a></li>
  
    <li><a href="/tags/html5" title="view all about 'html5' tag">html5 <span>(2)</span></a></li>
  
    <li><a href="/tags/图像Ping" title="view all about '图像Ping' tag">图像Ping <span>(1)</span></a></li>
  
    <li><a href="/tags/scroll" title="view all about 'scroll' tag">scroll <span>(1)</span></a></li>
  
    <li><a href="/tags/javascript" title="view all about 'javascript' tag">javascript <span>(4)</span></a></li>
  
    <li><a href="/tags/repaint" title="view all about 'repaint' tag">repaint <span>(1)</span></a></li>
  
    <li><a href="/tags/无限滚动" title="view all about '无限滚动' tag">无限滚动 <span>(1)</span></a></li>
  
    <li><a href="/tags/android" title="view all about 'android' tag">android <span>(1)</span></a></li>
  
    <li><a href="/tags/XDR" title="view all about 'XDR' tag">XDR <span>(1)</span></a></li>
  
    <li><a href="/tags/cocos2d-x" title="view all about 'cocos2d-x' tag">cocos2d-x <span>(1)</span></a></li>
  
    <li><a href="/tags/中国开发者大会广州站" title="view all about '中国开发者大会广州站' tag">中国开发者大会广州站 <span>(1)</span></a></li>
  
    <li><a href="/tags/跨域" title="view all about '跨域' tag">跨域 <span>(2)</span></a></li>
  
    <li><a href="/tags/XDomainRequest" title="view all about 'XDomainRequest' tag">XDomainRequest <span>(1)</span></a></li>
  
    <li><a href="/tags/CORS" title="view all about 'CORS' tag">CORS <span>(1)</span></a></li>
  
    <li><a href="/tags/ios" title="view all about 'ios' tag">ios <span>(1)</span></a></li>
  



                  </ul>
                </div>
              </div><!-- end sidebar -->
              <div class="main">
                <h2 class="result-header">All the articles by "优化" category:</h2>

	<div class="post">
    	<h2><a href="/blog/2013/06/04/reflow-and-repaint">关于 repaint 和 reflow 一些介绍</a></h2>
    	<ul class="meta">
    		<li class="date">
        		04 Jun 2013</li>
        		
        		
   
  	<li class="cate"><a href="/categories/优化" title="view all about '优化' category">
   		优化 <span>(1)</span>
   	</a></li>
  


    	    <li class="tag">
        		<ul>
        			
        			
  
  	<li><a href="/tags/reflow" title="view all about 'reflow' tag">reflow <span>(1)</span></a></li>
  
  	<li><a href="/tags/repaint" title="view all about 'repaint' tag">repaint <span>(1)</span></a></li>
  
  	<li><a href="/tags/前端优化" title="view all about '前端优化' tag">前端优化 <span>(1)</span></a></li>
  



        		</ul>
    		</li>
    	</ul>
    	<div class="text"><h3 id='_repaint__reflow'>什么是 repaint 和 reflow？</h3>

<p>一个页面由两部分组成：</p>

<ul>
<li>DOM：描述该页面的结构</li>

<li>render：描述 DOM 节点 (nodes) 在页面上如何呈现</li>
</ul>

<p>当 DOM 元素的属性发生变化 (如 color) 时, 浏览器会通知 render 重新描绘相应的元素, 此过程称为 repaint。</p>

<p>repaint(重绘)是在一个元素的外观被改变，但没有改变布局的情况下发生，如改变visibility、outline、前景色。</p>

<p>如果该次变化涉及元素布局 (如 width), 浏览器则抛弃原有属性, 重新计算并把结果传递给 render 以重新描绘页面元素, 此过程称为 reflow。</p>

<p>reflow(回流)是导致DOM脚本执行低效的关键因素之一。页面上任何一个结点触发reflow，都会导致它的子结点及祖先结点重新渲染。</p>

<h3 id='id2'>页面渲染的过程：</h3>
<p />
<ol>
<li>解析HTML代码并生成一个 DOM 树。</li>

<li>解析CSS文件，顺序为：浏览器默认样式-&gt;自定义样式-&gt;页面内的样式。</li>

<li>生成一个渲染树（render tree）。这个渲染树和 DOM 树的不同之处在于，它是受样式影响的。它不包括那些不可见的节点。 4. 当渲染树生成之后，浏览器就会在屏幕上“画”出所有渲染树中的节点。</li>
</ol>

<p>reflow 和 repaint 都是需要计算的，会消耗资源，影响用户体验。所有对用来生成渲染树的信息的改动都会触发 reflow 或者 repaint 。比如：添加或删除一个DOM节点、把一个节点的display设为none 等。由于reflow 和 repaint 会消耗资源，所以浏览器一般都会对此进行优化。有些浏览器会建立一个队列，把发生的 reflow 和 repaint 放进去，然后进行批处理。但是当你获取某些节点的样式信息的时候，会破坏浏览器的这种默认优化，强迫浏览器执行当前所有的 reflow 和 repaint。比如当你获取某个节点的 offsetTop 的时候，浏览器必须提供给你最新的数值，所以就需要把之前的 reflow 和 repaint 都执行。</p>

<h3 id='id3'>优化方法:</h3>
<p />
<h4 id='1_documentdom'>1. 避免在document上直接进行频繁的DOM操作</h4>
<p />
<ul>
<li>先将元素从document中删除，完成修改后再把元素放回原来的位置</li>

<li>将元素的display设置为”none”，完成修改后再把display修改为原来的值</li>

<li>如果需要创建多个DOM节点，可以使用DocumentFragment创建完后一次性的加入document</li>
</ul>
<p />
<h4 id='2_'>2. 集中修改样式</h4>
<p />
<ul>
<li>尽可能少的修改元素style上的属性</li>

<li>尽量通过修改className来修改样式</li>

<li>通过cssText属性来设置样式值</li>
</ul>
<p />
<h4 id='3_layout'>3. 缓存Layout属性值</h4>

<p>对于Layout属性中非引用类型的值（数字型），如果需要多次访问则可以在一次访问时先存储到局部变量中，之后都使用局部变量，这样可以避免每次读取属性时造成浏览器的渲染。</p>

<h4 id='4_positionabsolutefixed'>4. 设置元素的position为absolute或fixed</h4>

<p>在元素的position为static和relative时，元素处于DOM树结构当中，当对元素的某个操作需要重新渲染时，浏览器会渲染整个页 面。将元素的position设置为absolute和fixed可以使元素从DOM树结构中脱离出来独立的存在，而浏览器在需要渲染时只需要渲染该元素 以及位于该元素下方的元素，从而在某种程度上缩短浏览器渲染时间，这在当今越来越多的Javascript动画方面尤其值得考虑。</p>

<h4 id='5_'>5. 权衡速度的平滑</h4>

<p>比如实现一个动画，以1个像素为单位移动这样最平滑，但reflow就会过于频繁，CPU很快就会被完全占用。如果以3个像素为单位移动就会好很多。</p>

<h4 id='6_tables'>6. 不要用tables布局</h4>

<p>不要用tables布局的另一个原因就是tables中某个元素一旦触发reflow就会导致table里所有的其它元素reflow。在适合用table的场合，可以设置table-layout为auto或fixed，这样可以让table一行一行的渲染，这种做法也是为了限制reflow的影响范围</p>

<h4 id='7_cssexpression'>7. 不要在css里面写expression</h4>

<p>很多情况下都会触发reflow，如果css里有expression，每次都会重新计算一遍</p>

<p><strong><em>本文来自 <a href='http://www.zhoonchen.com/blog/2011/05/%E5%85%B3%E4%BA%8Erepaint%E5%92%8Creflow%E4%B8%80%E4%BA%9B%E4%BB%8B%E7%BB%8D/'>http://www.zhoonchen.com/</a></em></strong></p></div>
    </div>

              </div><!-- end main -->
            </div><!-- end contain -->
            <div class="footer">
              <div class="inner-footer">
                <p>All contents of this site, unless otherwise noted, are &copy;2013-Sun Jun 23 12:27:57 +0800 2013 <strong>Yongrui</strong>.  All Rights Reserved.</p>
                <p>Proudly powered by <a href="http://jekyllrb.com/">Jekyll</a>.</p>
              </div>
            </div><!-- end footer -->
          </div><!-- end site -->
    </body>
</html>
